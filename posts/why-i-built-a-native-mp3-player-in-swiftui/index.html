<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><title>In 2025, Apple still makes it hard to play your own MP3s, so I wrote my own app | Oleg Pustovit – Technical Leadership & MVP Development for Startups
</title><link rel=canonical href=https://nexo.sh/posts/why-i-built-a-native-mp3-player-in-swiftui/><meta name=description content="Technical leadership, MVP development, and scalable infrastructure consulting for startups and founders. Hands-on expertise in Go, Kubernetes, system design, and cloud architecture."><meta name=keywords content="Technical Leadership,MVP Development,Startup Engineering,Fractional CTO,Scalable Infrastructure,System Design,Go,Kubernetes,SaaS Startups,Technical Advisor,Oleg Pustovit"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="all,follow"><meta name=googlebot content="index,follow,snippet,archive"><meta property="og:url" content="https://nexo.sh/posts/why-i-built-a-native-mp3-player-in-swiftui/"><meta property="og:site_name" content="nexo blog"><meta property="og:title" content="In 2025, Apple still makes it hard to play your own MP3s, so I wrote my own app"><meta property="og:description" content="In 2025, playing your own music on an iPhone is surprisingly hard, unless you pay Apple or navigate a maze of limitations. So I built my own player from scratch, with full text search, iCloud support, and a local-first experience. GitHub link
Why I Built My Own Audio Player Like many people, I’ve picked up too many subscriptions, some through Apple (iCloud, Apple Music), others got lost in random platforms (like Netflix, which I forgot I was still paying for). I actually used Apple Music regularly (and previously Spotify), but the streaming turned out to be more convenience than necessity. With a curated local library, I didn’t lose much, just the lock-in."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-05-21T13:43:24+00:00"><meta property="article:modified_time" content="2025-05-21T13:43:24+00:00"><meta property="article:tag" content="Swift"><meta property="article:tag" content="Sqlite"><meta property="article:tag" content="Icloud"><meta property="article:tag" content="Ios"><meta property="article:tag" content="Apple"><meta property="article:tag" content="Xcode"><meta name=twitter:card content="summary"><meta name=twitter:title content="In 2025, Apple still makes it hard to play your own MP3s, so I wrote my own app"><meta name=twitter:description content="In 2025, playing your own music on an iPhone is surprisingly hard, unless you pay Apple or navigate a maze of limitations. So I built my own player from scratch, with full text search, iCloud support, and a local-first experience. GitHub link
Why I Built My Own Audio Player Like many people, I’ve picked up too many subscriptions, some through Apple (iCloud, Apple Music), others got lost in random platforms (like Netflix, which I forgot I was still paying for). I actually used Apple Music regularly (and previously Spotify), but the streaming turned out to be more convenience than necessity. With a curated local library, I didn’t lose much, just the lock-in."><meta name=viewport content="width=device-width,initial-scale=1"><link rel=stylesheet href=/lib/inter/font.css><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js></script><script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]--><link rel=icon type=image/png href=https://nexo.sh/images/favicon-96x96.png sizes=96x96><link rel=icon type=image/svg+xml href=https://nexo.sh/images/favicon.svg><link rel="shortcut icon" href=https://nexo.sh/images/favicon.ico><link rel=apple-touch-icon sizes=180x180 href=https://nexo.sh/images/apple-touch-icon.png><link rel=manifest href=https://nexo.sh/images/site.webmanifest><script async src="https://www.googletagmanager.com/gtag/js?id=G-82NPJKSTQK"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-82NPJKSTQK")}</script>
  
    
    
    
    
    
    
    
    
    
    
    
    
    
      
      <link rel="stylesheet" href="/css/combined.8cef5dea534cd2551526a2b799c5f14fabc46d42933d7551b5f8866a7838122718fcfd77a244c5a595bf459b81bc252f4a2b4b19760be46e8081c4af33022dee.css" integrity="sha512-jO9d6lNM0lUVJqK3mcXxT6vEbUKTPXVRtfiGang4EicY/P13okTFpZW/RZuBvCUvSitLGXYL5G6AgcSvMwIt7g==" crossorigin="anonymous">
    
  
</head><body class="bg-bg min-h-screen font-inter"><div id=header-wrapper class="w-full flex justify-center"><header id=main-header class="w-full max-w-[1440px] mx-auto px-4 sm:px-6 lg:px-8 pt-4 sm:pt-8 right-0 z-50 transition-colors duration-300"><nav class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-2 sm:gap-0"><a href=/ class="text-base sm:text-md font-semibold text-primary header-text">[nexo.sh]</a><div class="flex flex-wrap gap-2 sm:gap-4 sm:space-x-4 sm:space-x-8"><a href=/#services class="nav-item text-sm sm:text-md text-primary hover:text-primary/80 hover:underline transition-colors font-semibold header-text">/work</a>
<a href=/posts class="nav-item text-sm sm:text-md text-primary hover:text-primary/80 hover:underline transition-colors font-semibold header-text">/writings</a>
<a href=/#collaborate class="nav-item text-sm sm:text-md text-primary hover:text-primary/80 hover:underline transition-colors font-semibold header-text">/contact</a></div></nav></header></div><section class="w-full max-w-[1078px] mx-auto px-4 sm:px-6 lg:px-8 pt-24 pb-32"><article class="markdown post mt-16" itemscope itemtype=http://schema.org/BlogPosting><header class="mb-10 border-b border-primary/10 pb-4"><h1 class="text-4xl lg:text-5xl font-bold text-primary mb-8" itemprop="name headline">In 2025, Apple still makes it hard to play your own MP3s, so I wrote my own app</h1><div class="flex flex-wrap items-center gap-6 text-primary/70"><div class="flex items-center"><time datetime="2025-05-21 13:43:24.711 +0000 UTC" itemprop=datePublished>May 21, 2025</time>
<span class=mx-2>•</span>
<span>Oleg Pustovit</span></div></div></header><div class="prose prose-lg max-w-none text-primary/90" itemprop=articleBody><blockquote><p>In 2025, playing your own <strong>music on an iPhone is surprisingly hard</strong>, unless you pay Apple or navigate a maze of limitations. So I built my own player from scratch, with <strong>full text search</strong>, <strong>iCloud support</strong>, and a <strong>local-first experience</strong>. <a href=https://github.com/nexo-tech/music-app>GitHub link</a></p></blockquote><h2 id=why-i-built-my-own-audio-player>Why I Built My Own Audio Player</h2><img src=frame_source.webp alt="An image of a music app I&rsquo;ve built"><p>Like many people, I&rsquo;ve picked up too many subscriptions, some through Apple (iCloud, Apple Music), others got lost in random platforms (like Netflix, which I forgot I was still paying for). I actually used Apple Music regularly (and previously Spotify), but the streaming turned out to be more convenience than necessity. With a curated local library, I didn&rsquo;t lose much, just the lock-in.</p><p>Initially I thought, I&rsquo;d just keep using iCloud Music Library for cross-device music synchronization, but once I cancelled the Apple Music subscription, the sync stopped working. Turns out this feature is <strong>behind a paywall</strong>. You can technically get it back via <a href=https://support.apple.com/en-us/108935><em>iTunes Match</em> ($24.99/year)</a>. Match just stores 256-kbps AAC copies online; your original files stay put unless you choose to replace them. On a modern Mac, you do all this in the Music app. Without either subscription, cloud sync is gone, and you&rsquo;re back to cable/Wi-Fi syncing.</p><p>Frustrated with the lack of options, I went the <strong>builder route</strong>. If I bought a computing device (iPhone in this case), what stops me from just building exactly what I need with code to use it? In this article, I want to share my full journey of frustrations towards creating a basic music player functionality: loading audio files, organizing and playing them back, but mostly, I wanted to remind myself, <em>this is still a general-purpose computer, I should be able to make it do what I want</em>.</p><h2 id=what-apple-and-others-offer-today>What Apple (and Others) Offer Today</h2><p>Before writing my own app, I explored the official and third-party options for offline music playback.</p><h3 id=apples-built-in-apps>Apple&rsquo;s Built-in Apps</h3><p>Apple technically lets you play music directly from iCloud via the Files app, but its functionality is not designed for music listening. It <strong>lacks essential features</strong> such as playlist management, metadata sorting, or playback queues. While it supports music playback, it&rsquo;s very limited and overall <a href=https://discussions.apple.com/thread/252762868><strong>not a good user experience</strong></a>.</p><h3 id=third-party-apps>Third-Party Apps</h3><p>I went to the app store to look for cool apps that solve my problem, while there are many of them, many rely on <strong>subscription-based pricing</strong>, a questionable model for an app that simply plays files users already own. There&rsquo;s one app that I liked, <a href=https://apps.apple.com/us/app/doppler-mp3-flac-player/id1468459747>Doppler</a>. I&rsquo;ve played with it during a trial, but the UX is built around managing albums. The search wasn&rsquo;t that good, and the import functionality from iCloud was slow and hard to use on a large number of nested folders. The upside was, it had a single payment pricing model.</p><h2 id=going-builder-mode-my-technical-journey>Going Builder Mode: My Technical Journey</h2><p>With that said, I decided to create my own ideal music player that solves my pain points:</p><ul><li>Flexible full-text search across iCloud folders, so I can select and import a folder with music or specific files quickly.</li><li>Functionality in managing music at least on par with the official Music App: queue, playlist management, and sorting by albums, etc.</li><li>Familiar and friendly interface.</li></ul><h3 id=trying-react-native-first>Trying React Native First</h3><p>Initially, I avoided Swift because of my previous experience with it. A few years back, I liked the syntax (felt closer to TypeScript) and appreciated the Rust-like memory safety, but without native <code>async</code>/<code>await</code> at that time, writing concurrent code compared to Go or JS/TS felt clunky and boilerplate-heavy. That experience left me frustrated, so when I revisited this project, I initially reached for something more familiar.</p><p>That said, I went with React Native or Expo, hoping to reuse my web development experience and plug in a player UI from existing templates. Building the playback UI was straightforward; there are numerous open-source examples and tutorial videos on building good-looking music players that fit my needs. I picked an existing <a href=https://github.com/CodeWithGionatha-Labs/music-player>template project by Gionatha Sturba</a>, because it looked to have every feature I need for my app.</p><img src=rn-screenshot.webp alt="Attempting to build an app with React Native/Expo"><p>Accessing the file system and syncing cloud files hit major roadblocks: libraries like <a href=https://docs.expo.dev/versions/latest/sdk/filesystem/><code>expo-filesystem</code></a> supported basic file picking, but recursive traversal over deeply nested iCloud directories <strong>often failed or even caused app crashes</strong>. This made it clear that a <strong>JavaScript-based approach introduced more complexity</strong> than just working with Apple&rsquo;s native APIs, even if it meant a steeper learning curve.</p><p>iOS sandboxing prevents apps from reading files without explicit user permission, which meant React Native couldn&rsquo;t access external folders reliably. Switching to Swift gave me more control over iCloud file access and sandboxed permissions.</p><h3 id=switching-to-swiftui>Switching to SwiftUI</h3><p>I went with <strong>SwiftUI</strong> instead of UIKit or storyboards because I wanted a <strong>clean and declarative UI</strong> layer that would stay out of the way while I focused on domain logic and data synchronization. With modern features like async/await and integration with <strong>Swift Actors</strong>, I found it easier to manage data flow and concurrency. SwiftUI also definitely made it easier to structure the app into isolated ViewModel components, which in turn helped me get better results from LLMs like OpenAI o1 and DeepSeek. LLMs could produce pure UI code or data binding code without introducing messy interdependencies.</p><h2 id=app-architecture-and-data-model>App Architecture and Data Model</h2><p>Let&rsquo;s go over the architecture of the app I&rsquo;ve created: I used SQLite for persistent data storage and approached the app architecture as a simple server application. I avoided CoreData because I needed tight control over schema, raw queries, and especially full-text search. SQLite&rsquo;s built-in FTS5 support let me add fast fuzzy search without pulling in heavy external search engines or building my own indexing layer.</p><h3 id=three-main-screens>Three Main Screens</h3><p><strong>The app consists of 3 screen/modes:</strong></p><ol><li><strong>Library import.</strong> This is where you add your iCloud library folder. The app scans every folder for audio files and inserts every path into a SQLite database. This way, you can have full flexibility in searching, adding folders, and subfolders. Apple&rsquo;s native file picker is very clunky; you cannot select multiple directories that you searched by keyword and then also a bunch of files in one go. It simply is not designed to do that.</li><li><strong>Library management.</strong> This is where you can manage the added songs and organize playlists. For the most part, I&rsquo;ve reflected the way Apple did that in their Music app, and it was good enough for my needs.</li><li><strong>Player and playback.</strong> This part of the application manages queue management (repeat, shuffle), etc., and play, stop, and next song functionality.</li></ol><p>A simple user flow diagram is shown here:</p><figure><img src=/posts/why-i-built-a-native-mp3-player-in-swiftui/user-flow-diagram.svg alt="User flow diagram" width=600></figure><p><strong>User flow in practice:</strong> When the app launches with an empty library, it lands on the Sync tab, showing a big &ldquo;Add iCloud Source&rdquo; button. Pick a folder there, and the Sync screen displays a progress bar while it walks the tree. As soon as indexing finishes, it switches you to the Library tab, whose first screen lists <strong>Playlists / Artists / Albums / Songs</strong>. Dive into any list, tap a track, and a Mini-Player pops up along the bottom; tap that mini-bar to open the full-screen Player with shuffle, repeat, queue reorder, and volume. Swipe or tap the close icon, and you&rsquo;re straight back to the Library while playback continues. Any time you need more music, jump back to Sync, hit the &ldquo;+&rdquo; in the nav bar, select another folder, and the import service merges new songs in the background, no restart required.</p><h3 id=backend-like-logic-layer>Backend-Like Logic Layer</h3><p>Having a web/cloud background and shipped a lot of server code while working in startups, I went with a <strong>backend-like architecture</strong> for the mobile app. The whole domain/logic layer was separated from the <strong>View and View-Model layer</strong> because I had to nail the <strong>cloud syncing, metadata parsing</strong> aspect of the app and having clean data access to a SQLite DB. <em>Here&rsquo;s an approximate layered architecture diagram that I used here</em>:</p><figure><img src=/posts/why-i-built-a-native-mp3-player-in-swiftui/layers.svg alt="Layered architecture diagram" width=600></figure><p><strong>How the layers talk:</strong> SQLite sits at the bottom, storing raw song rows and FTS indexes. Then repositories wrap the database and expose async APIs. On top of those live my <strong>domain actors</strong>, Swift actors that own all business rules (import, search, queue logic) so state mutations stay <strong>thread-safe</strong>. ViewModels subscribe to the actors, transform the data into UI-ready structs, and SwiftUI views simply render whatever they get. Nothing crosses layers directly, keeping iCloud sync, playback, and UI <strong>nicely decoupled</strong>.</p><h2 id=implementing-full-text-search-with-sqlite>Implementing Full Text Search with SQLite</h2><p>Like I previously mentioned, it&rsquo;s fortunate that you can import an SQLite version with FTS capabilities: starting around iOS 11, it&rsquo;s available out of the box <strong>without extra setup</strong>. This made it easy to integrate fuzzy search into my music library <strong>without any third-party dependencies</strong>. Additionally, I used the SQLite.swift library for regular queries (which works as a sort of query builder with compile-time safety); however, for FTS queries, I had to resort to regular SQL statements.</p><p>SQLite&rsquo;s <a href=https://sqlite.org/fts5.html>FTS5</a> extension ended up being one of the most valuable pieces of the architecture. It let me query across file names and metadata like artist, album, and title without extra indexing infrastructure.</p><h3 id=setting-up-the-fts-tables>Setting Up the FTS Tables</h3><table><thead><tr><th>Domain</th><th>Swift actor / repo</th><th>FTS5 table</th><th>Columns that get indexed</th></tr></thead><tbody><tr><td>Library songs</td><td><code>SQLiteSongRepository</code></td><td><code>songs_fts</code></td><td><code>artist</code>, <code>title</code>, <code>album</code>, <code>albumArtist</code></td></tr><tr><td>Source-browser paths</td><td><code>SQLiteSourcePathSearchRepository</code></td><td><code>source_paths_fts</code></td><td><code>fullPath</code>, <code>fileName</code></td></tr></tbody></table><p>I used two FTS5 tables: one for indexed songs (artist/title/album) and one for file paths during folder import. Both tables live next to the primary rows in plain‐old B-tree tables (<code>songs</code>, <code>source_paths</code>). FTS is <strong>read-only for the UI</strong>; all writes happen inside the repositories so nothing slips through the cracks.</p><h4 id=creating-the-search-index>Creating the search index</h4><p>SQLite&rsquo;s built-in FTS5 makes quick searches easy. Here&rsquo;s a simple table definition I used:</p><figure class="relative my-8 border border-gray-100 overflow-hidden" role=figure aria-label="swift code snippet"><div class="flex items-center justify-between px-3 py-2 border-b border-gray-100"><div class="text-sm font-bold text-gray-600">swift</div><div class="code-copy relative"><div class="code-copied absolute right-0 top-8 min-w-[132px] bg-black text-white text-xs px-2 py-1 opacity-0 transition-opacity duration-300 pointer-events-none">Copied to clipboard</div><button class="cursor-pointer hover:text-gray-400 flex items-center justify-center w-6 h-6 text-gray-600 hover:text-black transition-colors focus:outline-none">
<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/></svg>
</button>
<textarea class=hidden>try db.execute(&#34;&#34;&#34;
CREATE VIRTUAL TABLE IF NOT EXISTS songs_fts USING fts5(
  songId UNINDEXED,
  artist, title, album, albumArtist,
  tokenize=&#39;unicode61&#39;
);
&#34;&#34;&#34;)</textarea></div></div><div class="overflow-x-auto bg-white"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-swift data-lang=swift><span class=line><span class=cl><span class=k>try</span> <span class=n>db</span><span class=p>.</span><span class=n>execute</span><span class=p>(</span><span class=s>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s>CREATE VIRTUAL TABLE IF NOT EXISTS songs_fts USING fts5(
</span></span></span><span class=line><span class=cl><span class=s>  songId UNINDEXED,
</span></span></span><span class=line><span class=cl><span class=s>  artist, title, album, albumArtist,
</span></span></span><span class=line><span class=cl><span class=s>  tokenize=&#39;unicode61&#39;
</span></span></span><span class=line><span class=cl><span class=s>);
</span></span></span><span class=line><span class=cl><span class=s>&#34;&#34;&#34;</span><span class=p>)</span></span></span></code></pre></td></tr></table></div></div></div></figure><p>I used <code>unicode61</code> tokenizer to ensure that a wide variety of characters are handled. Non-searchable keys are flagged with <code>UNINDEXED</code>, so they don&rsquo;t bloat the term dictionary.</p><h4 id=updating-data-reliably>Updating data reliably</h4><p>To keep things simple and safe, I wrapped updates and inserts in transactions. This ensures the search index never gets out of sync, even if the app crashes or gets interrupted.</p><figure class="relative my-8 border border-gray-100 overflow-hidden" role=figure aria-label="swift code snippet"><div class="flex items-center justify-between px-3 py-2 border-b border-gray-100"><div class="text-sm font-bold text-gray-600">swift</div><div class="code-copy relative"><div class="code-copied absolute right-0 top-8 min-w-[132px] bg-black text-white text-xs px-2 py-1 opacity-0 transition-opacity duration-300 pointer-events-none">Copied to clipboard</div><button class="cursor-pointer hover:text-gray-400 flex items-center justify-center w-6 h-6 text-gray-600 hover:text-black transition-colors focus:outline-none">
<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/></svg>
</button>
<textarea class=hidden>func upsertSong(_ song: Song) async throws {
    db.transaction {
        // insert or update main song data
        // insert or update search index data
    }
}</textarea></div></div><div class="overflow-x-auto bg-white"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-swift data-lang=swift><span class=line><span class=cl><span class=kd>func</span> <span class=nf>upsertSong</span><span class=p>(</span><span class=kc>_</span> <span class=n>song</span><span class=p>:</span> <span class=n>Song</span><span class=p>)</span> <span class=n>async</span> <span class=kr>throws</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>db</span><span class=p>.</span><span class=n>transaction</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// insert or update main song data</span>
</span></span><span class=line><span class=cl>        <span class=c1>// insert or update search index data</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div></div></figure><h3 id=querying-with-fuzzy-search>Querying with Fuzzy Search</h3><p>For user-friendly search, I add wildcard support automatically. If you type &ldquo;lumine,&rdquo; it searches for &ldquo;lumine*&rdquo; internally, giving instant results even with partial queries.</p><p>I also leverage SQLite&rsquo;s built-in smart ranking (<code>bm25</code>) to return more relevant results without extra complexity:</p><figure class="relative my-8 border border-gray-100 overflow-hidden" role=figure aria-label="sql code snippet"><div class="flex items-center justify-between px-3 py-2 border-b border-gray-100"><div class="text-sm font-bold text-gray-600">sql</div><div class="code-copy relative"><div class="code-copied absolute right-0 top-8 min-w-[132px] bg-black text-white text-xs px-2 py-1 opacity-0 transition-opacity duration-300 pointer-events-none">Copied to clipboard</div><button class="cursor-pointer hover:text-gray-400 flex items-center justify-center w-6 h-6 text-gray-600 hover:text-black transition-colors focus:outline-none">
<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/></svg>
</button>
<textarea class=hidden>SELECT s.*
FROM songs s JOIN songs_fts fts ON s.id = fts.songId
WHERE songs_fts MATCH ?
ORDER BY bm25(songs_fts)
LIMIT ? OFFSET ?;</textarea></div></div><div class="overflow-x-auto bg-white"><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=n>s</span><span class=p>.</span><span class=o>*</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>songs</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=k>JOIN</span><span class=w> </span><span class=n>songs_fts</span><span class=w> </span><span class=n>fts</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>s</span><span class=p>.</span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>fts</span><span class=p>.</span><span class=n>songId</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=n>songs_fts</span><span class=w> </span><span class=k>MATCH</span><span class=w> </span><span class=o>?</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>bm25</span><span class=p>(</span><span class=n>songs_fts</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>LIMIT</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=k>OFFSET</span><span class=w> </span><span class=o>?</span><span class=p>;</span></span></span></code></pre></td></tr></table></div></div></div></figure><p>Overall, using raw SQLite gave me the flexibility I needed: predictable schema, local-first access, and powerful full-text search, without introducing any network dependencies or external services. This approach was ideal for an app designed to be private and offline-first.</p><h2 id=working-with-ios-files-and-bookmarks>Working with iOS Files and Bookmarks</h2><p>On iOS, apps can store persistent bookmarks to file locations, but <strong>security-scoped bookmarks</strong>, which grant extended access to files outside the app&rsquo;s sandbox, are only available on <strong>macOS</strong>. iOS apps can use regular bookmarks to remember file paths and request access again through the document picker, but that access isn’t guaranteed to persist silently. See <a href=https://developer.apple.com/documentation/foundation/nsurl#Bookmarks-and-Security-Scope>Apple&rsquo;s bookmark documentation</a>.</p><p>To mitigate this, I implemented a fallback mechanism that copies files into the <strong>app&rsquo;s own sandboxed container</strong>. This avoids the fragile lifecycle of security-scoped bookmarks that can silently break if iOS resets the permissions. By copying files proactively in the background, while the bookmark is valid, there&rsquo;s no risk in accessing invalid audio-file references.</p><p>This approach also improves indexing speed. I can scan the folder structure once (while access is active), import only relevant audio files, and safely traverse deeply nested directories. But reliably playing back individual audio files from external locations, especially after device restarts, <em>remains an unsolved problem to me</em>. This highlights how <strong>under-supported</strong> this use case is, even for native apps, and how complex it still is to <strong>handle file access reliably on iOS</strong>.</p><h2 id=building-the-playback-and-ui>Building the Playback and UI</h2><h3 id=metadata-parsing>Metadata Parsing</h3><p>To parse metadata from audio files, I used Apple&rsquo;s <strong>AVFoundation framework</strong>, specifically the <strong>AVURLAsset</strong> class, which allows inspection of media file metadata, such as title, album artist, etc. While metadata parsing is handled by the native SDK, certain fields like track numbers you have to manually look up from ID3 tags. I relied on <a href=https://github.com/TastemakerDesign/Warper/blob/2af8c07ad8422f4dc3a539177d3a76ee8502e632/plugins/flutter_media_metadata/ios/Classes/Id3MetadataRetriever.swift>GitHub search</a> to find examples, since the official documentation lacked coverage for edge cases.</p><h3 id=audio-playback-with-avfoundation>Audio Playback with AVFoundation</h3><p>After the library is indexed, implementing an audio player feels pretty simple: you just have to initialize an instance of <code>AVAudioPlayer</code> and let the audio play. Additionally, for quality-of-life features: playing music from the control center, I had to implement the <code>AVAudioPlayerDelegate</code> protocol and also hooked into Apple&rsquo;s <code>MPRemoteCommandCenter</code>, which lets developers respond to system-level playback controls.</p><h2 id=reflections-apple-developer-lock-in-and-the-future>Reflections: Apple, Developer Lock-In, and the Future</h2><p>Here&rsquo;s what stood out during development:</p><h3 id=the-bad>The Bad</h3><p><strong>Xcode&rsquo;s limitations remain frustrating.</strong> Real-time SwiftUI previews are definitely a step forward, but the overall development experience still isn&rsquo;t on par with what Flutter offered five years ago: tight VSCode integration, real-time simulator reloads, and familiar debugging tools.</p><p><strong>Lack of editor flexibility.</strong> Setting up Language Server Protocol (LSP) support for Swift in Neovim or VSCode requires extra tooling like <a href=https://github.com/SolaWing/xcode-build-server><code>xcode-build-server</code></a>, and still doesn&rsquo;t fully match the developer experience of web-first ecosystems.</p><p><strong>Some corners of Apple&rsquo;s SDK still live in Objective-C land.</strong> Spotlight file search, for instance, is only exposed through <code>NSMetadataQuery</code>, which uses Key-Value Observing (KVO) and string keys, no Swift-friendly wrapper yet. Documentation is often sparse, which steepens the learning curve.</p><p><strong>SwiftUI&rsquo;s declarative UI is great, but debugging iCloud interactions still requires manual mocks.</strong> SwiftUI previews can&rsquo;t emulate full app behaviors involving iCloud entitlements, so you have to mock cloud interactions manually, a minor annoyance but notable.</p><h3 id=the-good>The Good</h3><p><strong>Async/await.</strong> Finally, I can write I/O-bound concurrent code like an imperative one with no annoying callbacks. That&rsquo;s a big win, and I greatly appreciate how easy it is to write even sync code into Actors and call it like you do in JavaScript ecosystems.</p><p><strong>Plethora of native libs.</strong> Yes, you&rsquo;re not limited by open source bindings like in React Native/Flutter ecosystems. Here you have much more freedom in developing something &ldquo;more serious&rdquo; than your company/product website replacement (because of poor mobile-first experience). Many Apple&rsquo;s APIs are available with examples, which made it easy to get started.</p><p><strong>SwiftUI</strong> itself. Yes, the React-style approach to building UIs gives more productivity and space for explorations. It&rsquo;s just great that Apple adopted it.</p><h3 id=summary-building-should-be-easier>Summary: Building Should Be Easier</h3><p>After 1.5 weeks of hacking around, I was able to get the piece of software which exactly satisfies my needs: a <strong>local/offline music player</strong> that can import audio files from cloud storage.</p><p>But developers quickly realize they can&rsquo;t easily deploy apps to their own devices these days and forget about it: apps only run for <a href=https://developer.apple.com/support/compare-memberships><strong>7 days without a dev certificate</strong></a>, and after that, you have to rebuild it, unless you paid $99 to Apple to enroll in the development program.</p><p>Even after the <strong>DMA Act in the EU</strong>, sideloading still isn&rsquo;t fully open. EU users can now install apps from third-party marketplaces directly from a developer&rsquo;s site, but only if that developer still enrolled in Apple&rsquo;s $99/year program and agrees to Apple&rsquo;s Alternative Terms. For personal/hobbyist use, this still doesn’t remove the 7-day dev build limitation.</p><p>This makes ultimately no sense. An innovative technology company actively puts roadblocks into democratized application development. Even Progressive Web Applications (PWAs) <a href=https://brainhub.eu/library/pwa-on-ios>face notable limitations on iOS</a>: even after Apple&rsquo;s 16-18.x updates, iOS PWAs still run inside Safari&rsquo;s sandbox. They get WebGL2 and web-push, but they don&rsquo;t get Web Bluetooth/USB/NFC, Background Sync, or more than ~50MB of guaranteed storage. WebGL runs through Metal shim, so real-world frame-rates often trail native Metal apps; this is good enough for UI, but not for AAA 3D games.</p><p>Nowadays, AI has reduced the complexity of modern software development by allowing anyone to tackle unknown technologies by providing all the necessary knowledge in an accessible way. You can clearly see how web development got more interest from non-technical people who have a way to build their ideas without specializing in a plethora of technologies. But when it comes to mobile apps, you just have to play by the artificial rules. <em>Even if you built it yourself, for yourself, Apple still gets the final say</em> before you can run it for more than a week. The same company that once empowered independent developers now imposes <strong>tight restrictions that hinder personal app development</strong> and distribution. AI has made it easier than ever to build new tools, unless you&rsquo;re building for iOS, where the gate is still locked.</p><h2 id=related-links>Related Links</h2><ul><li><a href=https://support.apple.com/en-us/HT204146>iTunes Match – Apple Support</a></li><li><a href=https://developer.apple.com/documentation/foundation/nsurl#1664002>Security-Scoped Bookmarks – Apple Docs</a></li><li><a href=https://sqlite.org/fts5.html>FTS5 – SQLite Documentation</a></li><li><a href=https://apps.apple.com/us/app/doppler-music-player/id1500875779>Doppler Music Player – App Store</a></li><li><a href=https://docs.expo.dev/versions/latest/sdk/filesystem/>Expo FileSystem Documentation</a></li><li><a href=https://developer.apple.com/programs/>Apple Developer Program Info (7-day builds)</a></li><li><a href="https://discussions.apple.com/thread/252762868?sortBy=rank">Apple Community: Files App & MP3 Playback</a></li></ul></div><div class="mt-12 mb-8"><div class="flex flex-wrap gap-2 opacity-70"><a href=/tags/swift class="text-orange hover:text-orange-600 transition-colors text-sm">#swift
</a><a href=/tags/sqlite class="text-orange hover:text-orange-600 transition-colors text-sm">#sqlite
</a><a href=/tags/icloud class="text-orange hover:text-orange-600 transition-colors text-sm">#icloud
</a><a href=/tags/ios class="text-orange hover:text-orange-600 transition-colors text-sm">#ios
</a><a href=/tags/apple class="text-orange hover:text-orange-600 transition-colors text-sm">#apple
</a><a href=/tags/xcode class="text-orange hover:text-orange-600 transition-colors text-sm">#xcode</a></div></div><section class="w-full mx-auto max-w-[1078px] mt-8 sm:mt-12 text-primary"><form action=https://app.kit.com/forms/7961988/subscriptions class="seva-form formkit-form w-full" method=post data-sv-form=7961988 data-uid=842da55da6 data-format=inline data-version=5 data-options='{"settings":{"after_subscribe":{"action":"message","success_message":"Success! Now check your email to confirm your subscription.","redirect_url":""},"analytics":{"google":null,"fathom":null,"facebook":null,"segment":null,"pinterest":null,"sparkloop":null,"googletagmanager":null},"modal":{"trigger":"timer","scroll_percentage":null,"timer":5,"devices":"all","show_once_every":15},"powered_by":{"show":true,"url":"https://kit.com/features/forms?utm_campaign=poweredby&amp;utm_content=form&amp;utm_medium=referral&amp;utm_source=dynamic"},"recaptcha":{"enabled":false},"return_visitor":{"action":"show","custom_content":""},"slide_in":{"display_in":"bottom_right","trigger":"timer","scroll_percentage":null,"timer":5,"devices":"all","show_once_every":15},"sticky_bar":{"display_in":"top","trigger":"timer","scroll_percentage":null,"timer":5,"devices":"all","show_once_every":15}},"version":"5"}'><div class="mb-4 sm:mb-6"><h3 class="text-xl sm:text-2xl font-bold font-helvetica mb-2">Join the Newsletter</h3><p class="text-base sm:text-lg text-primary/80 font-helvetica">Get the latest technical deep dives and startup insights.</p></div><div class="flex flex-col sm:flex-row gap-3 sm:gap-4 items-start sm:items-end"><div class="formkit-field flex-1 w-full"><input class="w-full text-lg sm:text-xl font-bold bg-transparent border-b-2 border-primary focus:outline-none focus:border-primary/80 py-2 font-helvetica" name=email_address aria-label="Email Address" placeholder="Email Address" required type=email></div><button type=submit class="w-full sm:w-auto text-lg sm:text-xl font-bold bg-primary text-white px-4 sm:px-6 py-2 hover:bg-primary/90 transition-colors duration-200 font-helvetica whitespace-nowrap">
<span class="flex items-center justify-center"><span class="formkit-spinner hidden mr-2"><svg class="animate-spin h-4 w-4 sm:h-5 sm:w-5" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentcolor" stroke-width="4" fill="none"/><path class="opacity-75" fill="currentcolor" d="M4 12a8 8 0 018-8V0C5.373.0.0 5.373.0 12h4zm2 5.291A7.962 7.962.0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"/></svg>
</span><span>Subscribe</span></span></button></div><ul class="formkit-alert formkit-alert-error hidden mt-3 sm:mt-4 bg-red-50 border border-red-200 rounded-lg p-3 sm:p-4 text-red-600"></ul></form><script>document.addEventListener("DOMContentLoaded",function(){const e=document.querySelector(".seva-form"),t=e.querySelector(".formkit-alert-error"),n=e.querySelector('button[type="submit"]'),s=n.querySelector(".formkit-spinner");e.addEventListener("submit",async function(o){o.preventDefault(),n.disabled=!0,s.classList.remove("hidden"),t.classList.add("hidden");try{const t=new FormData(e),n=await fetch(e.action,{method:"POST",body:t});if(n.ok)e.innerHTML=`
            <div class="text-center">
              <p class="text-xl text-primary/80">Thanks for subscribing! Check your email to confirm.</p>
            </div>
          `;else throw new Error("Subscription failed")}catch{t.classList.remove("hidden"),t.innerHTML="<li>Something went wrong. Please try again.</li>"}finally{n.disabled=!1,s.classList.add("hidden")}})})</script></section><div class="mt-16 pt-8 border-primary/10"><div class="grid grid-cols-3 gap-8"><div class=col-span-1><span class="block text-sm text-primary/60 mb-2">Previous</span>
<a href=https://nexo.sh/posts/microservices-for-startups/ class="text-lg font-medium text-primary hover:text-primary/80 transition-colors">Microservices Are a Tax Your Startup Probably Can’t Afford</a></div><div class="col-span-1 flex justify-center"><div class="h-full w-px bg-primary/10"></div></div><div class="col-span-1 text-right"></div></div></div></article></section><div class=relative><footer class="w-full bg-black text-white pt-2 footer-reveal overflow-hidden"><div class="w-full mx-auto px-4 sm:px-6 lg:px-8 relative"><div class="grid grid-cols-1 md:grid-cols-3 gap-6 md:gap-0 items-center border-white/20 footer-info"><div class="justify-self-center md:justify-self-start"><a href=# class="group flex items-center text-white/70 hover:text-white transition-colors back-to-top"><svg class="h-6 w-6 mr-2 transform group-hover:-translate-y-1 transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentcolor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0 7 7m-7-7v18"/></svg>
<span>Back to top</span></a></div><div class="justify-self-center text-center text-white/70"><span>Copyright © Oleg Pustovit 2025</span>
<span class=mx-2>|</span>
<a href=/privacy-policy class="hover:text-white transition-colors">Privacy Policy</a></div><div class="justify-self-center md:justify-self-end text-center md:text-right text-white/70"><span class=location></span>
<span class=kyiv-time></span></div></div><div class="text-center brand-container overflow-hidden"><div class=brand-reveal><div class="flex gap-8 flex-wrap justify-center items-center"><a href=/ class="inline-block text-7xl md:text-8xl lg:text-9xl font-black tracking-normal text-white hover:text-white/90 transition-colors mr-2 md:mr-4 lg:mr-6"><span class="font-bold text-white/40">follow</span>
<span class=brand-text>me</span>
<span class="font-bold text-white/40">on</span></a><div class="social-icon mt-6"><a href=https://github.com/nexo-tech target=_blank rel=noopener class="text-white hover:text-white/90 transition-colors"><i class="fa-brands fa-github text-5xl md:text-6xl lg:text-7xl"></i></a></div><div class="social-icon mt-6"><a href=https://x.com/nexo_v1 target=_blank rel=noopener class="text-white hover:text-white/90 transition-colors"><i class="fa-brands fa-x-twitter text-5xl md:text-6xl lg:text-7xl"></i></a></div><div class="social-icon mt-6"><a href=https://www.linkedin.com/in/nexo-tech/ target=_blank rel=noopener class="text-white hover:text-white/90 transition-colors"><i class="fa-brands fa-linkedin text-5xl md:text-6xl lg:text-7xl"></i></a></div></div><style>.social-icon a{display:inline-block;transition:transform .2s ease-in-out}.social-icon a:hover{transform:scale(1.1)}</style></div></div></div></footer><div id=after-footer class="bg-black absolute bottom-0 left-0 w-full"></div></div></body><link rel=stylesheet href=/lib/font-awesome/css/all.min.css><script src=/js/bundle.min.73edd18ed1ad8aee2e121b9b014fca4be6862cf0039aa4f8e3b8d171d640b85b.js integrity="sha256-c+3RjtGtiu4uEhubAU/KS+aGLPADmqT447jRcdZAuFs=" defer></script></html>